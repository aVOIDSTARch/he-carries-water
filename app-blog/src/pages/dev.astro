---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import ProjectCard from '../components/ProjectCard.astro';
import { getCollection } from 'astro:content';

// Get all projects from content collection
const projects = await getCollection('projects');

// Sort by order, then by stars
const sortedProjects = projects.sort((a, b) => {
	// Featured first
	if (a.data.featured !== b.data.featured) {
		return a.data.featured ? -1 : 1;
	}
	// Then by order
	if (a.data.order !== b.data.order) {
		return (a.data.order ?? 999) - (b.data.order ?? 999);
	}
	// Then by stars
	return b.data.stars - a.data.stars;
});

const hasProjects = projects.length > 0;
---

<html lang="en">
	<head>
		<BaseHead title="Dev Projects" description="My open source projects and experiments" />
	</head>
	<body>
		<Header />
		<main class="w-full max-w-[900px] mx-auto p-4 min-h-screen">
			<!-- Page Header -->
			<div class="border-2 border-black bg-white p-6 mb-8 shadow-custom">
				<h1 class="text-4xl font-mono uppercase font-bold mb-2">
					<span class="text-accent-dark">&gt;</span> Dev Zone
				</h1>
				<p class="font-mono text-gray-dark">
					Open source projects, experiments, and things I've built
				</p>
			</div>

			{hasProjects ? (
				<>
					<!-- Featured Projects Grid -->
					<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
						{sortedProjects.map(project => (
							<ProjectCard
								name={project.data.name}
								description={project.data.description}
								slug={project.data.slug}
								language={project.data.language}
								stars={project.data.stars}
								topics={project.data.topics}
								lastPushed={project.data.lastPushed}
								githubUrl={project.data.githubUrl}
							/>
						))}
					</div>
				</>
			) : (
				<!-- Empty State - Under Construction -->
				<div class="space-y-6">
					<div class="border-4 border-black bg-yellow-300 p-8 shadow-[8px_8px_0px_0px_black]">
						<h2 class="text-4xl md:text-6xl font-mono font-bold uppercase text-center mb-4 text-black">
							üöß Coming Soon üöß
						</h2>
						<p class="text-xl font-mono text-center text-black uppercase font-bold">
							Projects are being synced from GitHub
						</p>
					</div>

					<div class="border-2 border-black bg-black p-6 shadow-custom">
						<div class="font-mono text-sm text-green-400">
							<p class="mb-2">$ npm run sync-projects</p>
							<p class="mb-2 text-yellow-400">‚ö° Fetching repositories from GitHub...</p>
							<p class="mb-2">‚úì Connecting to API</p>
							<p class="mb-2">‚úì Authenticating</p>
							<p class="text-yellow-400 animate-pulse">‚è≥ Waiting for admin to select projects...</p>
						</div>
					</div>
				</div>
			)}

			<!-- Back Button -->
			<div class="mt-8 text-center">
				<a
					href="/"
					class="inline-block px-6 py-3 border-2 border-black bg-white font-mono uppercase font-bold hover:bg-accent hover:text-white transition-all shadow-[4px_4px_0px_0px_black] hover:translate-x-[4px] hover:translate-y-[4px] hover:shadow-none"
				>
					‚Üê Back Home
				</a>
			</div>
		</main>
		<Footer />
	</body>
</html>

<style>
	.shadow-custom {
		box-shadow: 4px 4px 0px 0px var(--color-black);
	}

	@keyframes pulse {
		0%, 100% {
			opacity: 1;
		}
		50% {
			opacity: 0.7;
		}
	}

	.animate-pulse {
		animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
	}
</style>
