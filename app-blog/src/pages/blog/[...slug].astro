---
import { type CollectionEntry, getCollection, getEntry, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

// In SSR mode, we fetch the post dynamically based on the slug
const { slug } = Astro.params;

if (!slug) {
	return Astro.redirect('/404');
}

// Filter out browser extension requests and other non-markdown files
if (slug.includes('.js') || slug.includes('.map') || slug.includes('.css')) {
	return new Response(null, { status: 404 });
}

// For [...slug] routes, the slug might include slashes. Get just the first segment
const actualSlug = slug.split('/')[0];

// Fetch the specific blog post
const post = await getEntry('blog', actualSlug);

if (!post) {
	return new Response(null, { status: 404 });
}

const { Content } = await render(post);
---

<BlogPost {...post.data}>
	<Content />
</BlogPost>
